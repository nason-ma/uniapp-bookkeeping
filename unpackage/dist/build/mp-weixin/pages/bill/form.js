(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bill/form"],{"0e07":function(t,i,e){"use strict";e.d(i,"b",(function(){return n})),e.d(i,"c",(function(){return o})),e.d(i,"a",(function(){return a}));var a={uIcon:function(){return e.e("uview-ui/components/u-icon/u-icon").then(e.bind(null,"7a76"))},uActionSheet:function(){return e.e("uview-ui/components/u-action-sheet/u-action-sheet").then(e.bind(null,"5694"))},uCalendar:function(){return e.e("uview-ui/components/u-calendar/u-calendar").then(e.bind(null,"c38e"))}},n=function(){var t=this,i=t.$createElement,e=(t._self._c,Math.ceil(t.categories.length/(2*t.gridCol)));t._isMounted||(t.e0=function(i,e){var a=arguments[arguments.length-1].currentTarget.dataset,n=a.eventParams||a["event-params"];e=n.index2;return t.categoryChange(e)}),t.$mp.data=Object.assign({},{$root:{l0:e}})},o=[]},"11f8":function(t,i,e){"use strict";e.r(i);var a=e("0e07"),n=e("4ee0");for(var o in n)"default"!==o&&function(t){e.d(i,t,(function(){return n[t]}))}(o);e("8d7a");var s,l=e("f0c5"),c=Object(l["a"])(n["default"],a["b"],a["c"],!1,null,"d068282c",null,!1,a["a"],s);i["default"]=c.exports},"4e79":function(t,i,e){"use strict";(function(t){e("27d5");a(e("66fd"));var i=a(e("11f8"));function a(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,e("543d")["createPage"])},"4ee0":function(t,i,e){"use strict";e.r(i);var a=e("a963"),n=e.n(a);for(var o in a)"default"!==o&&function(t){e.d(i,t,(function(){return a[t]}))}(o);i["default"]=n.a},"8d7a":function(t,i,e){"use strict";var a=e("d9fc"),n=e.n(a);n.a},a963:function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e={name:"billform",props:{billInfo:{type:Object,default:null}},watch:{billInfo:function(t,i){this.billInfo=t,this.billInfo2BillData()}},data:function(){return{BillFormShow:!1,billData:{id:0,ledger_id:0,date:"",type:0,account_id:0,amount:"",category_id:0,note:"",images:[]},chooseImages:[],accountsShow:!1,accountName:"",accounts:[],categoryColorClass:"text-orange",categories:[],decCategories:[],inCategories:[],gridCol:5,gridBorder:!1,categorySwiperCurrent:0,old:{categorySwiperCurrent:0},pickerDateShow:!1}},methods:{swiperScroll:function(t){this.old.categorySwiperCurrent=t.detail.current},showPickerDate:function(){this.pickerDateShow=!0},pickerDateConfirm:function(t){this.billData.date=t.result},billType:function(t){this.billData.type=parseInt(t.currentTarget.dataset.type),this.typeChange(),this.billData.category_id=this.categories[0].id},typeChange:function(){this.categoryColorClass=0==this.billData.type?"text-orange":"text-blue",this.categories=0==this.billData.type?this.decCategories:this.inCategories,this.categorySwiperCurrent=this.old.categorySwiperCurrent,this.$nextTick((function(){this.categorySwiperCurrent=0}))},categoryChange:function(t){this.billData.category_id=this.categories[t].id},ChooseImage:function(){var i=this;t.chooseImage({count:4,sizeType:["original","compressed"],success:function(e){0!=i.chooseImages.length?i.chooseImages=i.chooseImages.concat(e.tempFilePaths):i.chooseImages=e.tempFilePaths,i.$u.api.Common.uploadImage(e.tempFilePaths[0],"bill").then((function(e){var a=e[1];if(200==a.statusCode){var n=JSON.parse(a.data);i.billData.images=i.billData.images.concat(n.path)}else t.showToast({title:"图片上传失败",icon:error,duration:2e3})}))}})},ViewImage:function(i){t.previewImage({urls:this.chooseImages,current:i.currentTarget.dataset.url})},DelImg:function(i){var e=this;t.showModal({title:"提示",content:"确定删除？",cancelText:"取消",confirmText:"确定",success:function(t){t.confirm&&(e.chooseImages.splice(i.currentTarget.dataset.index,1),e.billData.images.splice(i.currentTarget.dataset.index,1))}})},accountCallback:function(i){t.hideKeyboard(),this.billData.account_id=this.accounts[i].id,this.accountName=this.accounts[i].text},accountChange:function(t){this.accountsShow=!0},getCategories:function(t){var i=this;this.$u.api.Category.categories(t).then((function(e){0===t?(i.decCategories=e.data,i.categories=e.data,i.billData.category_id=e.data[0].id):i.inCategories=e.data}))},getAccounts:function(){var t=this;this.$u.api.Common.accounts().then((function(i){t.accounts=i.data,t.accountName=i.data[0].text}))},init:function(){this.getCategories(0),this.getCategories(1),this.getAccounts()},initBillData:function(){this.categories=this.decCategories,this.billData.id=0,this.billData.ledger_id=0,this.billData.type=0,this.billData.account_id=0,this.billData.amount="",this.billData.category_id=this.categories[0].id,this.billData.note="",this.billData.images=[],this.chooseImages=[],this.initDate()},billInfo2BillData:function(){this.billData.id=this.billInfo.id,this.billData.ledger_id=this.billInfo.ledger_id,this.billData.date=this.billInfo.date_text,this.billData.type=this.billInfo.type,this.billData.account_id=this.billInfo.account_id,this.billData.amount=Math.abs(this.billInfo.amount),this.billData.category_id=this.billInfo.category_id,this.billData.note=this.billInfo.note,this.billData.images=this.billInfo.images,this.chooseImages=this.billInfo.images,this.accountName=this.billInfo.account.text,1==this.billInfo.type?this.categories=this.decCategories:this.categories=this.inCategories,this.typeChange()},initDate:function(){var t=(new Date).getFullYear(),i=(new Date).getMonth()+1,e=(new Date).getDate();i=i<10?"0"+i:i,this.billData.date=t+"-"+i+"-"+e},save:function(){var i=this,e=this.billData.id>0?"更新":"创建";if(""==this.billData.amount||this.billData.amount<=0)return t.showToast({title:"金额填写有误",icon:"error",duration:2e3}),!1;this.$u.api.Bill.save(this.billData).then((function(a){!1!==a?(i.hideBillForm(),i.$emit("reload"),t.showToast({title:e+"成功",duration:2e3}),0===i.billData.id&&i.initBillData()):t.showToast({title:e+"失败",icon:"error",duration:2e3})})).catch((function(t){console.log(t)}))},showBillForm:function(){this.BillFormShow=!0},hideBillForm:function(){this.BillFormShow=!1,this.billData.id>0?this.billInfo2BillData():this.initBillData()}},mounted:function(){this.$store.state.vuex_scopeUserInfo||t.redirectTo({url:"/pages/auth/auth"}),this.initDate(),this.init()}};i.default=e}).call(this,e("543d")["default"])},d9fc:function(t,i,e){}},[["4e79","common/runtime","common/vendor"]]]);